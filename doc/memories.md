# memories.md

## 1. プロジェクト概要 / ゴール

- **SCP財団(Wikidot)のタグ翻訳ツール**を、**静的ファイルのみ（HTML + 外部JSON）で運用**できるようにする。
- **複数の言語ペア**に対応し、タグを入力すると即座に翻訳結果が得られる。
- **大規模（数千～）のタグ**に対応するため、**辞書は言語ペアごとに分割して遅延読み込み**する方式を採用。
- **ダークモード（`prefers-color-scheme`）**やスマホでの**レスポンシブ対応**など、実運用に耐えうるUI/UXを目指す。

## 2. 課題・背景

- SCP財団のタグは多数・多言語であり、**単純な1ファイルの辞書管理**ではファイルサイズと読み込み負荷が大きくなる。
- 既存の翻訳機能（Google翻訳など）ではSCP独自のタグが正しく翻訳されない問題がある。
- **サーバーサイド不要**でGitHub Pagesなどに簡単にホスティングしたい要望があった。

## 3. 意思決定の経緯

1. **はじめは**単一の `tagMap.json` にすべてのペアを詰め込む案があったが、**大規模化**に備え、
   - **辞書をペア単位で分割**して必要に応じて遅延ロードする方針へ。
2. **UIデザイン**は「Google翻訳」風の左右テキストエリアを採用。
3. **入れ替えボタン**は不要との要望があり、最終的に削除。
4. ログを編集できないようにし、**非使用タグ(null)** や **未定義タグ**を検知するとログ表示する。
5. **LocalStorage**使用は取りやめ（iframe越しなどの懸念があるため）。
6. **翻訳元言語タグ**を翻訳結果に付与する要望があり、最終版で `srcLang` を先頭に挿入するロジックを追加。

## 4. 実装概要 / 現在のスクリプト・設定

- **index.html**
  - 単一ページにすべてのUIとロジックを集約し、静的に配信する。
  - 翻訳元・先の言語ドロップダウン、翻訳結果テキストエリア、コピー機能、ログ表示領域、ローディング表示などを実装。
  - **連結タグの前方最長一致**で翻訳キーを切り出し、未定義はログへ。
  - ダークモードは `prefers-color-scheme: dark` で自動切り替え。レスポンシブ対応で幅が狭いと縦配置に。
- **dictionaries/ フォルダ**
  - `en_to_jp.json` など、`source_to_target.json` 形式で辞書を管理。
  - 必要に応じて `fetch()` でロードし、メモリにキャッシュ。
  - ファイルが存在しないペアは 404 → 「未対応ペア」としてログ表示。

## 5. 今後の TODO

- **他言語ペア**（16言語）を順次追加：
  - `jp_to_en.json`, `en_to_cn.json` など必要ファイルを作成し、UIのドロップダウンでコメントアウトを外す。
- **タグ数のさらなる増加**への対策：
  - 必要に応じて辞書をさらに細かく分割（例：先頭文字別ファイル）など検討。
- **テスト整備**：
  - 大量タグを実際に翻訳する際のパフォーマンス・正確性の検証。
- **UI拡張**：
  - 自動補完やタグのドラッグ＆ドロップなど、さらなる利便性向上のアイデア。

## 6. 注意点・運用ルール

- **辞書ファイル名は `source_to_target.json`** で統一。
- **「非使用タグ」は値を `null`** にする。ログに「(非使用タグ)」が表示され、結果には含まれない。
- **大きな設計変更**（例えば新たな翻訳アルゴリズム導入など）があれば、このファイル（`memories.md`）を更新する。
- **不要になったペアは削除**し、ドロップダウンからもコメントアウトする。

## 7. 雑記

- 一時期 `LocalStorage` でユーザーの設定保持を検討したが、iframe 越しの制限があり廃止。
- 入れ替えボタンも試作されたが、要件上不要と判断。
- 将来的に**翻訳元言語タグが重複挿入されないよう**にするロジックを入れ、簡易的に `translatedList.includes(srcLang)` をチェック。
- 現在はシンプルな線形検索で連結タグを解釈しているが、タグがさらに増えた場合にトライ木などの構造を検討する可能性もあり。
